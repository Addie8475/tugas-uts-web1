<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>History Pemesanan - Toko Buku</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">

  <div class="container">
    <div class="card header">
      <h2>History Transaksi</h2>
      <div class="nav">
        <a href="stok.html">Katalog</a>
        <a href="checkout.html">Pemesanan</a>
        <a href="tracking.html">Tracking</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="history.html" class="active">History</a>
        <a href="index.html">Keluar</a>
      </div>
    </div>

    <div class="card">
      <table class="table" id="tblHistory">
        <thead>
          <tr>
            <th>Nomor DO</th>
            <th>Nama Pemesan</th>
            <th>Tanggal</th>
            <th>Total</th>
            <th>Detail</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card hidden" id="boxDetail">
      <h3>Detail Pemesanan</h3>
      <p><strong>No DO:</strong> <span id="dNo"></span></p>
      <p><strong>Pemesan:</strong> <span id="dNama"></span></p>
      <p><strong>Tanggal:</strong> <span id="dTanggal"></span></p>

      <h4>Daftar Item</h4>
      <table class="table">
        <thead><tr><th>Nama Buku</th><th>Qty</th><th>Harga</th></tr></thead>
        <tbody id="dItems"></tbody>
      </table>

      <div style="text-align:right;margin-top:10px">
        <button id="btnCloseDetail" class="btn btn-outline">Tutup</button>
      </div>
    </div>

  </div>

<script>
  const tblBody = document.querySelector('#tblHistory tbody');
  const boxDetail = document.getElementById('boxDetail');
  const laporan = JSON.parse(sessionStorage.getItem('laporan') || '[]');

  function renderTable(){
    tblBody.innerHTML = '';

    if(laporan.length === 0){
      tblBody.innerHTML = `<tr><td colspan="5" class="center small">Belum ada transaksi yang tersimpan</td></tr>`;
      return;
    }

    laporan.forEach((row,i)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${row.nomorDO}</td>
        <td>${row.nama}</td>
        <td>${row.tanggal}</td>
        <td>${row.total || 'Simulasi'}</td>
        <td><button data-i="${i}" class="btn btn-primary">Detail</button></td>
      `;
      tblBody.appendChild(tr);
    });

    document.querySelectorAll('#tblHistory button[data-i]').forEach(btn=>{
      btn.onclick = (e)=>{
        const i = +e.target.dataset.i;
        showDetail(i);
      }
    });
  }

  function showDetail(i){
    const data = laporan[i];
    document.getElementById('dNo').textContent = data.nomorDO;
    document.getElementById('dNama').textContent = data.nama;
    document.getElementById('dTanggal').textContent = data.tanggal;

    const dItems = document.getElementById('dItems');
    dItems.innerHTML = '';
    data.items.forEach(it=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${it.nama}</td><td>${it.qty}</td><td>${it.harga}</td>`;
      dItems.appendChild(tr);
    });

    boxDetail.classList.remove('hidden');
  }

  document.getElementById('btnCloseDetail').onclick = ()=>{
    boxDetail.classList.add('hidden');
  }

  renderTable();
</script>

</body>
</html>
